# 需求
远程管理系统支持选择对应终端，上传程序包，以便前置系统远程升级。

请场控在安装联邦管理服务程序的服务器上，规划一个路径，专门用于前置系统软件升级。该路径下有两个文件夹，一个命名为EcsUpdate，用于接受远程管理系统下发的升级的相关文件，一个命名为UpdateFeed，用于联邦管理存放升级反馈文件。

远程管理系统以一定的交互方式可以让用户在界面上选择需要升级的风机，用户选择后，将所选风机的ip地址等信息通过json格式，写入文本，远程管理系统将该文本与程序包（压缩文件格式）下发至EcsUpdate，联邦管理系统定时扫描EcsUpdate，如果该路径下有新程序包产生，则触发升级程序。

文本文件的名字与升级的压缩文件名字一致，例如需要升级的压缩文件为V2.1_20210105.tar(暂定)，则文本文件的名字为V2.1_20210105.txt
json格式：
{
    "name": "XXXX.tar", 
    "type": 1,#默认为1，为以后不同的升级类型预留
    "time":"2021-01-05 11:31:45", #生成json文件的时间，可以直接取远程管理系统时间
    "turbine":["192.168.101.101", "192.168.101.102", "192.168.101.103", "192.168.101.104",......]
}

升级完成后，联邦管理系统将升级反馈（升级时间，版本号，是否成功等）同样以json格式写至文件V2.1_20210105_feed.txt，放置在UpdateFeed下，如果升级失败，则将失败信息打包为同样名称的压缩文件（V2.1_20210105_feed.tar），一起放置在UpdateFeed下，远程管理系统可在发出升级指令后，扫描检查UpdateFeed，发现feed的文本文件后，通过解析该文件，判断是否升级成功，对于升级失败的机组，给出提示，哪些机组升级失败。
如果升级失败，支持导出UpdateFeed下同名称的压缩文件，以查看升级结果。
json格式：
{
    "name": "XXXX.tar",
    "type": 1,#默认为1，为以后不同的升级类型预留
    "time":"2021-01-05 11:31:45", #生成json文件的时间，可以直接取联邦管理系统所在服务器时间"192.168.101.101": "V2.1_20210105", #远程管理系统以版本号判断是否升级成功，如果版本号与升级包压缩文件的文件名称一致，那么则代表升级成功，如果不一致，代表失败。
    "192.168.101.102": "V2.1_20210105","192.168.101.103": "V2.1_20210105",,......
}

# 实现思路
升压站服务器运行一个docker镜像，将rtferoal与rtframe的集成在一起，rtframe提供python算法的运行
平台，实现周期写数据库算法、应用仓库更新算法。算法自动运行、错误自动重启

平台暂时没有考虑远程更新，需要支持的python库，需要打包在/rtfdata/third_party/pythonlib目录下，避免更新docker镜像。

## rtframe前端增加版本的设置和显示功能

## 周期写数据库算法

考虑调用rtfedoral的接口实现，这样可以一次批量获取全部的终端信息。
rtfedoral需要增加软件仓库版本的字段信息。

* 需要考虑的问题：rtfedoral怎样自动扫描获取整个风场的终端ip

## 应用仓库更新算法

检测输入目录，更新后，写输出目录。考虑直接调用rtfagent的rest接口实现，一台一台更新。

## 调试功能，如日志获取等

运行一个监听算法，检测input目录是否有customer.sh，通过python算法运行该sh,然后，将执行结果
结果输出至output目录的customer.log，customer.sh产生的输出为customer_output.tar。
